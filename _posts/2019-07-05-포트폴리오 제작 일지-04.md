---
layout:     post
title:      포트폴리오 제작 일지-04
author:     쭌프로
tags:       JAVA Javascript Reactjs JPA Spring-Boot
subtitle:   Spring-Boot-React 풀스택 포트폴리오 인증 구현 제작
category:   JAVA
---

<!-- Start Writing Below in Markdown -->

![Description](https://alalstjr.github.io/jjunpro.github.io/img/java_bg.png)

# Auth 인증

Client(outside your app domain) -> Auth Server
사용자가 서버에 로그인 인증을 시도합니다. (facebook, google, 등등..)

Auth Server 에서 Token {JWT} 를 만들어 Client로 반환 합니다.

Token {JWT}을 Application(REST) 로 전송하여 올바른 token 값이면 접근을 허용하도록 합니다.

<a href="https://www.youtube.com/watch?v=x6bzYyMY0GA">Spring Security JWT Authentication</a>

## 요구사항

- 모든 인증은 AJAX 요청 기반으로 이뤄진다.
- HS-256 기반으로 암호화된 JWT를 발급한 후 HttpServletResponse로 돌려줄 수 있어야 한다.
- Controller에 method security를 적용한다.
- 소셜 공급자(NAVER, KAKAO, FACEBOOK 등등) 통한 로그인을 구현하기 위해 기초작업을 한다.

## Spring Security

- 1. 사용자의 request 요청 -> 필터 -> 인증요청 객체로 변환
- 2. 

### AuthenticationManager - AuthenticationProvider 주머니

- Builder 패턴으로 구현
- 등록된 Authentication Provider들에 접근하는 유일한 객체
- 단순 인터페이스에 불과하다. 내장 구현체:ProviderManager
- AuthenticationManager를 구현해서 쓰지말자. Pivotal 기술자보다 더 잘 만들 자신 없으면
- 구현해서 쓰라고 넣어준 인터페이스 아니다.

### AuthenticationProvider 진짜 인증이 일어나는곳

- 인증 "전" 객체를 받아 인증 가능 여부를 체크한 후, 예외를 던지던지 인증 "훈" 객체를 만들어 돌려준다.
- 구현하라고 넣어준 인터페이스다
- 필요에 맞게 정교하게 구현하고 인증 관리자에 등록시키자.

### 인증객체는 뭔가?

Authentication 클래스의 모든 서브클래스
Authentication 은 인터페이스입니다.
인증된 사용자는 권한을 가지고 있다고 봅니다.

### UsernamePasswordAuthenticationToken

<a href="https://docs.spring.io/spring-security/site/docs/4.2.12.RELEASE/apidocs/org/springframework/security/authentication/UsernamePasswordAuthenticationToken.html">
  UsernamePasswordAuthenticationToken.html 문서
</a>

The principal and credentials should be set with an Object that provides the respective property via its Object.toString() method. The simplest such Object to use is String.

Object.toString() method 로 어떠한 정보가 존재하는지 볼 수 있어야 합니다.
유저 ID and Password 를 Object.toString() 으로 확인하고 어떠한 값이 나오는지 구분할 수 있는 값을 넣어라

UsernamePasswordAuthenticationToken 은 기본적으로 2개의 Constructors 를 가지고 있습니다.
- Object principal 
- Object credentials

인증의 주체가 되는 모든것을 principal 이라 부릅니다.

결론은 인증이 시작할 시점을 명시해 줄 수 있는 객체가 와야 한다.

유저 ID and Password 로 인증을 하는 상황을 예로 들어보면 Password를 가지고 유저 repository 에서 객체를 가져오는 경우는 없습니다.
유저 ID 을 통해서 유저 객체를 불러온 다음에 인증처리를 합니다.

결국 Object principal 는 인증을 시작해주는 역활을 해주는 유저 ID 이 됩니다.
그러면 자동으로 Object credentials 는 Password 가 됩니다.

결론은 유저ID 와 Password 를 들고있는 객체를 만들어주는 생성자 입니다.

# 참고자료
https://swalloow.github.io/implement-jwt
